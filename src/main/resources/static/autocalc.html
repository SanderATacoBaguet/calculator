<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Electric Circuit AutoCalc</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Electric Circuit AutoCalc</h1>

    <label>Voltage (V):</label>
    <input type="number" id="voltage" value="24"><br><br>

    <h2>Add Resistors</h2>
    <div id="resistorList"></div>

    <label>Resistor Name:</label>
    <input type="text" id="resistorName" placeholder="R1, Rp1, etc.">

    <label>Value (Ω):</label>
    <input type="number" id="resistorValue" placeholder="e.g., 12">

    <label>Parallel Group (optional):</label>
    <input type="text" id="parallelGroup" placeholder="Rp1, Rp2, etc.">

    <label>Use Calculated Value:</label>
    <select id="useCalculated">
        <option value="no">No</option>
        <option value="yes">Yes</option>
    </select>

    <button onclick="addResistor()">Add</button>
    <button onclick="calculateCircuit()">Calculate Circuit</button>

    <h2>Results:</h2>
    <div id="results"></div>

    <script>
        let resistors = [];

        function addResistor() {
            const name = document.getElementById('resistorName').value;
            const value = parseFloat(document.getElementById('resistorValue').value) || 0;
            const group = document.getElementById('parallelGroup').value || null;
            const useCalc = document.getElementById('useCalculated').value;

            resistors.push({ name, value, group, useCalculated: useCalc });

            renderResistors();
        }

        function renderResistors() {
            const listDiv = document.getElementById('resistorList');
            listDiv.innerHTML = '';
            resistors.forEach((r, i) => {
                const div = document.createElement('div');
                div.innerHTML = `${r.name} = ${r.value} Ω ${r.group ? '(Parallel: ' + r.group + ')' : '(Series)'} 
                                 [Use Calculated: ${r.useCalculated}] 
                                 <button onclick="removeResistor(${i})">Remove</button>`;
                listDiv.appendChild(div);
            });
        }

        function removeResistor(index) {
            resistors.splice(index, 1);
            renderResistors();
        }

        async function calculateCircuit() {
            const voltage = parseFloat(document.getElementById('voltage').value) || 0;
            const response = await fetch('/electric/calculate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ voltage, resistors })
            });
            const data = await response.json();

            document.getElementById('results').innerHTML = `
                Total Resistance: ${data.totalResistance.toFixed(2)} Ω<br>
                Total Current: ${data.totalCurrent.toFixed(4)} A<br>
                <pre>${data.details}</pre>
            `;
        }
    </script>
</body>
</html>
